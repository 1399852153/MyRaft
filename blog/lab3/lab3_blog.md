# 手写raft(三) 实现日志压缩
在上一篇博客中MyRaft实现了日志复制功能，按照计划接下来需要实现日志压缩。
* [手写raft(一) 实现leader选举](https://www.cnblogs.com/xiaoxiongcanguan/p/17569697.html)
* [手写raft(二) 实现日志复制](https://www.cnblogs.com/xiaoxiongcanguan/p/17636220.html)
## 1. 什么是raft日志压缩？
我们知道raft协议是基于日志复制的协议，日志数据是raft的核心。但随着raft集群的持续工作，raft的日志文件将会维护越来越多的日志，而这会带来以下几个问题。
1. 日志文件过大会占用所在机器过多的本地磁盘空间。
2. 对于新加入集群的follower，leader与该follower之间完成日志同步会非常缓慢。
3. 对于自身不进行持久化的状态机，raft节点重启后回放日志也会非常缓慢。
#####
考虑到绝大多数的状态机中存储的数据并不都是新增，而更多的是对已有数据的更新，则状态机中所存储的数据量通常会远小于raft日志的总大小。例如K/V数据库，对相同key的N次操作，只有最后一次操作是实际有效的，而在此之前的针对该key的raft日志其实已经没有保存的必要了。  
因此raft的作者在论文的日志压缩一节中提出了几种日志压缩的算法(基于快照的、基于LSM树的)，raft选择了更容易理解和实现的、基于状态机快照的算法作为日志压缩的基础。  

## 2. MyRaft日志压缩实现分析

## 3. MyRaft日志压缩测试case

## 总结